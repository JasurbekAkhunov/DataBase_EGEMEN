<HTML>
<HEAD>
<TITLE>BEFOREINSERTLABRECETE3</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<LINK HREF="../IBEHTMLDoc.css" type=text/css rel=STYLESHEET>
 
<xml>
<IBEHelp:Attr Name="ItemOrder" Value="895800"/>
</xml>
 
</HEAD>
<BODY>
<DIV ID="nsbanner">
  <DIV ID="bannerrow1">
    <TABLE CLASS="bannerparthead" CELLSPACING=0>
      <TR ID="hdr" VALIGN="middle">
        <TD CLASS="runninghead">"E:\Egemen\EB01\Dataserver\DATA\FERGANAGLOBAL\EB01DATA.GDB". Triggers</TD>
        <TD ALIGN="left" WIDTH="54px" NOWRAP>
          <A HREF="BEFOREINSERTLABRECETE2.html"><IMG ALT="Previous topic" SRC="../Images/GoPrev.gif" BORDER="0"></A>
          <A HREF="../Index.html"><IMG ALT="Chapter index" SRC="../Images/GoIndex.gif" BORDER="0"></A>
          <A HREF="BEFOREINSERTLABRECETE4.html"><IMG ALT="Next topic" SRC="../Images/GoNext.gif" BORDER="0"></A>
        </TD>
      </TR>
    </TABLE>
  </DIV>
  <DIV ID="TitleRow">
    <P CLASS="dtH1">BEFOREINSERTLABRECETE3</P>
  </DIV>
 </DIV>
<P CLASS="Base">&nbsp;</P>
<P CLASS="Header1">Description</P>
<P CLASS="Base"><I>(There is no description for trigger BEFOREINSERTLABRECETE3)</I></P>
<P CLASS="Base">&nbsp;</P>
<P CLASS="Header1">Definition</P>
<P CLASS="Base"><span class="DDLCode">
<code><pre>
<b>CREATE</b><b> </b><b>TRIGGER</b><b> </b><font color="# 080 0"><u>BEFOREINSERTLABRECETE3</u></font><b> </b><b>FOR</b><b> </b><font color="# 080 0"><u>LABRECETE</u></font>
<b>ACTIVE</b><b> </b><b>BEFORE</b><b> </b><b>INSERT</b><b> </b><b>POSITION</b><b> </b>3
<b>as</b>
<b>declare</b><b> </b><b>variable</b><b> </b>LabReceteFirmaBaslangic<b>   </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>LabReceteFirmaDigit<b>       </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>LabReceteAyraci<b>           </b><b>varchar</b><b>(</b>1<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>MaxNumara<b>                 </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>NumaraStr<b>                 </b><b>varchar</b><b>(</b>20<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>MaxLen<b>                    </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>FLabReceteKodu<b>            </b><b>varchar</b><b>(</b>20<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>NumaraDigit<b>               </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>LabReceteKoduTipi<b>         </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>TurId<b>                     </b><b>varchar</b><b>(</b>4<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>DerinlikId<b>                </b><b>varchar</b><b>(</b>2<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>GrupId<b>                    </b><b>varchar</b><b>(</b>2<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>TF<b>     </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>YilStr<b>                    </b><b>varchar</b><b>(</b>4<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>LabReceteGrupStr<b>          </b><b>varchar</b><b>(</b>2<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>ReceteHamTipiId<b>           </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>HamTipiStr<b>                </b><b>varchar</b><b>(</b>1<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>IkiHaneYil<b>                </b><b>varchar</b><b>(</b>2<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>I<b> </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>RenkDerinligiIcinX<b>        </b><b>varchar</b><b>(</b>1<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>RenkDerinligiAdi<b>          </b><b>varchar</b><b>(</b>20<b>)</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>EgemenFirmaID<b>             </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>YilAyStr<b>                  </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>ReceteTurId<b>               </b><b>integer</b><b>;</b>
<b>declare</b><b> </b><b>variable</b><b> </b>FHaslik<b>                   </b><b>varchar</b><b>(</b>2<b>)</b><b>;</b>
<b>begin</b>
<b>  </b><b>Select</b><b> </b>LabReceteFirmaBaslangic<b>,</b><b> </b>LabReceteFirmaDigit<b>,</b><b> </b>LabReceteAyraci<b>,</b><b> </b>LabReceteKoduTipi<b>,</b><b> </b>EgemenFirmaID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>Sistem</u></font><b> </b><b>into</b><b> </b>:LabReceteFirmaBaslangic<b>,</b><b> </b>:LabReceteFirmaDigit<b>,</b><b> </b>:LabReceteAyraci<b>,</b><b> </b>:LabReceteKoduTipi<b>,</b><b> </b>:EgemenFirmaID<b>;</b>

<b>  </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>62<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Egna */</i></font>
<b>  </b><b>begin</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>Select</b><b> </b>GrupId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>into</b><b> </b>:GrupId<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruID<b> </b><b>into</b><b> </b>:TurId<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b>LabReceteGrupStr<b> </b><b>=</b><b> </b>'X'<b> </b><b>;</b>
<b>    </b><b>else</b><b> </b>LabReceteGrupStr<b> </b><b>=</b>''<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>&lt;</b><b> </b>0<b> </b><b>and</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>&gt;</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>' Renk Grup Hatalı...'<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b>  </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>10000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>20000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>30000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>40000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>50000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>60000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>70000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>80000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>90000<b>;</b>
<b>      </b><b>end</b>

<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>LabReceteGrupStr<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b>  </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>5<b>)</b><b>;</b>

<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>      </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b>-</b>4<b>,</b><b> </b>5<b>)</b><b>;</b>
<b>      </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>10000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>20000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>20000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>30000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>30000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>40000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>40000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>50000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>50000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>60000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>60000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>70000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>70000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>80000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>80000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>90000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>90000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>100000<b>)</b><b>)</b><b> </b><b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' Numara ='<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntegerToStr</u></font><b>(</b><b>New</b><b>.</b>Numara<b>)</b><b>;</b>
<b>      </b><b>end</b>

<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>LabReceteGrupStr<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b>  </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>5<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>        </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' FRK ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b> </b>'- N.RK='<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>56<b>  </b><b>or</b><b> </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>121<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* RemÖrme , Ekose  */</i></font>
<b>  </b><b>begin</b>
<b>     </b>YilStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>TimeStampToYil</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b>;</b>

<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>

<b>    </b><b>New</b><b>.</b>YilAyStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b>YilStr<b>,</b><b> </b>3<b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>FirmaId<b> </b><b>is</b><b> </b><b>Not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>YilAyStr<b> </b><b>=</b><b> </b><b>New</b><b>.</b>YilAyStr<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b>
<b>      </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b><b>New</b><b>.</b>YilAyStr<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>      </b>NumaraDigit<b> </b><b>=</b><b> </b>6<b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>TurID<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>DerinlikId<b>)</b><b>;</b>

<b>      </b>MaxLen<b> </b><b>=</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>-</b><b> </b>NumaraDigit<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b>NumaraDigit<b>,</b><b> </b>MaxLen<b>)</b><b>;</b>

<b>      </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b><b>New</b><b>.</b>YilAyStr<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>'-'<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>       </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' FRK ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b> </b>'- N.RK'<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>64<b> </b><b>or</b><b> </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>78<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Forte, Istanbul Boya */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruID<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>        </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabReceteGrupId<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>receteturuid<b> </b><b>=</b><b> </b><b>New</b><b>.</b>receteturuid
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>          </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'C'<b> </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>        </b><b>end</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>         </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>          </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabReceteGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>          </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'FRT'<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>        </b><b>end</b>
<b>     </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>76<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Sateks*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabReceteGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>85<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Akateks*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>

<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>70<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* CeylanTeks */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>GrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>      </b>NumaraDigit<b> </b><b>=</b><b> </b>4<b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>TurID<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>GrupID<b>)</b><b> </b><b>;</b>

<b>      </b>MaxLen<b> </b><b>=</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>-</b><b> </b>NumaraDigit<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b>NumaraDigit<b>,</b><b> </b>MaxLen<b>)</b><b>;</b>

<b>      </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>       </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' FRK ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b> </b>'- N.RK'<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>71<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Aycan */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b>1<b> </b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b>TurId<b> </b><b>=</b><b> </b>4<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b>TurId<b> </b><b>=</b><b> </b>5<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b>TurId<b> </b><b>=</b><b> </b>6<b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b>2<b> </b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b>TurId<b> </b><b>=</b><b> </b>1<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b>TurId<b> </b><b>=</b><b> </b>2<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b>TurId<b> </b><b>=</b><b> </b>3<b>;</b>
<b>    </b><b>end</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>&lt;</b><b> </b>0<b> </b><b>and</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>&gt;</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>' Renk Grup Hatalı...'<b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>KaliteId<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>          </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabReceteGrupId<b> </b><b>and</b>
<b>                </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b>
<b>                </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>kaliteid<b> </b><b>is</b><b> </b><b>null</b>
<b>          </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b>  </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>else</b>
<b>        </b><b>begin</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LAbreceteGrupId<b> </b><b>=</b><b> </b>1<b> </b><b>)</b><b> </b><b>then</b>
<b>          </b><b>begin</b>
<b>            </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>101700<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>201700<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>301700<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>402100<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>502900<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>602700<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>702700<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>800900<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>902300<b>;</b>
<b>          </b><b>end</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LAbreceteGrupId<b> </b><b>=</b><b> </b>2<b> </b><b>)</b><b> </b><b>then</b>
<b>          </b><b>begin</b>
<b>            </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>102300<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>203400<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>302700<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>403900<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>505100<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>606300<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>703100<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>802100<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>904100<b>;</b>
<b>          </b><b>end</b>
<b>        </b><b>end</b>

<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b>   </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b>TurId<b>,</b>1<b>)</b><b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>6<b>)</b><b> </b><b>;</b>

<b>      </b><b>end</b>
<b>      </b><b>else</b>
<b>        </b><b>New</b><b>.</b>LabreceteKodu<b> </b><b>=</b><b> </b><b>new</b><b>.</b>KaliteId<b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>

<b>      </b>NumaraStr<b>  </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b>-</b>5<b>,</b><b> </b>6<b>)</b><b>;</b>
<b>      </b>HamTipiStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b>-</b>7<b>,</b><b> </b>1<b>)</b><b>;</b>

<b>      </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>      </b>I<b>  </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>HamTipiStr<b>)</b><b> </b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b>I<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>        </b><b>if</b><b> </b><b>(</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>100000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>200000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>200000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>300000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>300000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>400000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>400000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>500000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>500000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>600000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>600000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>700000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>700000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>800000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>800000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>900000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>900000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>1000000<b>)</b><b>)</b><b> </b><b>)</b><b> </b><b>then</b>

<b>             </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' Numara ='<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntegerToStr</u></font><b>(</b><b>New</b><b>.</b>Numara<b>)</b><b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b>HamTipiStr<b> </b><b>&lt;</b><b>&gt;</b><b> </b>4<b>)</b><b> </b><b>or</b>
<b>           </b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b>HamTipiStr<b> </b><b>&lt;</b><b>&gt;</b><b> </b>5<b>)</b><b> </b><b>or</b>
<b>           </b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>3<b> </b><b>and</b><b> </b>HamTipiStr<b> </b><b>&lt;</b><b>&gt;</b><b> </b>6<b>)</b><b> </b><b>or</b>
<b>           </b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b>HamTipiStr<b> </b><b>&lt;</b><b>&gt;</b><b> </b>1<b>)</b><b> </b><b>or</b>
<b>           </b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b>HamTipiStr<b> </b><b>&lt;</b><b>&gt;</b><b> </b>2<b>)</b><b> </b><b>or</b>
<b>           </b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>3<b> </b><b>and</b><b> </b>HamTipiStr<b> </b><b>&lt;</b><b>&gt;</b><b> </b>3<b>)</b><b>)</b><b> </b><b>then</b>
<b>           </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b><b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>6<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>        </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' FRK ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b> </b>'- N.RK='<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>72<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Toraman */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabReceteGrupId<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>76<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*  NewJakard */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>      </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>            </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId
<b>      </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>2<b> </b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b><b>  </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabreceteGrupId<b> </b><b>=</b><b> </b>3<b> </b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b>  </b>'F'<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>      </b><b>end</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>77<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Pakipek*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruID<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>  </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>            </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>28<b>)</b><b>   </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>23<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>2000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>20<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>3000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>33<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>4000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>16<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>5000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>21<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>6000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>30<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>7000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>18<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>8000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>12<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>9000<b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>IkihaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>79<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* 79-TekstilTrans */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>

<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>and</b>
<b>        </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b>

<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntegerToStr</u></font><b>(</b><b>New</b><b>.</b>LabRenkGrupId<b>)</b><b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>80<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* RayTeks */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>GrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>and</b><b> </b><b>new</b><b>.</b>labgrupid<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>and</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>LabgrupId<b> </b><b>is</b><b> </b><b>null</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>0<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>0001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>2001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>3001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>4001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>5001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>6001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>7001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>8001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>9001<b>;</b>
<b>      </b><b>end</b>

<b>     </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>labrenkgrupid<b> </b><b>=</b><b> </b>0<b>)</b><b> </b><b>then</b><b>  </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'R'<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>     </b><b>else</b>
<b>     </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'R'<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>and</b><b> </b><b>new</b><b>.</b>labgrupid<b>=</b>'01'<b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b>  </b><b>and</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>LabgrupId<b>=</b>'01'
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>0<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>2001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>3001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>4001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>5001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>6001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>7001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>8001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>9001<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>kayithatasi</u></font><b>;</b>
<b>      </b><b>end</b>

<b>     </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>receteturuid<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>       </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'L'<b>    </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>     </b><b>else</b>
<b>       </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'L'<b> </b><b>|</b><b>|</b><b> </b>TurId<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>

<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>82<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* GökÇağ */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>GrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>7<b> </b><b>and</b>
<b>        </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b>
<b>      </b><b>begin</b>
<b>       </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b>
<b>         </b><b>(</b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>1<b> </b><b>or</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>and</b>
<b>        </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>      </b><b>end</b>

<b>    </b><b>end</b>

<b>    </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>      </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>     </b><b>new</b><b>.</b>Numara<b>=</b>1<b> </b><b>;</b>
<b>    </b><b>end</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b>
<b>    </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>
<b>    </b><b>else</b>
<b>    </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>

<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>67<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Senpa */</i></font>
<b>  </b><b>begin</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b>YilAyStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_month</u></font><b>(</b><font color="# 080 0"><u>timestamptodatestr</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LAbrenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>into</b><b> </b>:GrupId<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b>
<b>        </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>0<b>;</b>
<b>      </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>GrupId<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b>YilAyStr<b>,</b><b> </b>2<b>)</b><b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b>  </b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>90<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*MicBro*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>

<b>      </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>        </b>numarastr<b> </b><b>=</b><b> </b>'MB-I-'<b>|</b><b>|</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b>;</b>
<b>      </b><b>else</b>
<b>        </b>numarastr<b> </b><b>=</b><b> </b>'MB-'<b>|</b><b>|</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b>;</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteKodu<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteKodu<b> </b><b>like</b><b> </b>:NumaraStr<b>|</b><b>|</b>'%'
<b>        </b><b>into</b><b> </b>:FLabReceteKodu<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b>FLabReceteKodu<b> </b><b>=</b><b> </b><b>Replace</b><b>(</b>FLabReceteKodu<b>,</b><b> </b>NumaraStr<b>,</b><b> </b>''<b>)</b><b>;</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>FLabReceteKodu<b>)</b><b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b>

<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>NumaraStr<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabreceteKoduTipi<b> </b><b>=</b><b> </b>99<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Megam*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>GrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabreceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>Max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>Labrecete</u></font><b> </b><b>where</b>
<b>        </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b>
<b>        </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>        </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>labrecetekodu<b> </b><b>not</b><b> </b><b>starts</b><b> </b><b>with</b><b> </b>'F'
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b>
<b>      </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b> </b><b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>     </b><b>if</b><b> </b><b>(</b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>,</b>1<b>,</b>1<b>)</b><b> </b><b>=</b><b> </b>'F'<b>)</b><b> </b><b>then</b>
<b>     </b><b>begin</b>
<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>'F'<b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b>GrupId<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>     </b><b>end</b>
<b>     </b><b>else</b>
<b>     </b><b>begin</b>
<b>      </b>NumaraDigit<b> </b><b>=</b><b> </b>2<b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>TurID<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>GrupId<b>)</b><b>;</b>
<b>      </b>MaxLen<b> </b><b>=</b><b> </b><b>Char_length</b><b>(</b><b>New</b><b>.</b>LabreceteKodu<b>)</b><b> </b><b>;</b>

<b>      </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b>NumaraDigit<b>+</b>1<b>,</b><b> </b><b>(</b>maxlen<b>-</b>numaradigit<b>)</b><b>)</b><b>;</b>

<b>      </b>I<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b><b>(</b>I<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>and</b><b> </b><b>char_length</b><b>(</b>NumaraStr<b>)</b><b>=</b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>     </b><b>if</b><b> </b><b>(</b><b>char_length</b><b>(</b>TurID<b>)</b><b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>         </b><b>if</b><b> </b><b>(</b><b>(</b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>,</b>1<b>,</b>1<b>)</b><b> </b><b>=</b><b> </b>TurID<b> </b><b>)</b><b> </b><b>and</b><b> </b><b>(</b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>,</b>2<b>,</b>1<b>)</b><b> </b><b>=</b><b> </b>GrupID<b>)</b><b>)</b><b> </b><b>then</b>
<b>         </b>TF<b>=</b>1<b>;</b>
<b>         </b><b>else</b>
<b>         </b>TF<b>=</b>0<b> </b><b>;</b>
<b>        </b><b>end</b>
<b>       </b><b>else</b>
<b>         </b><b>begin</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>(</b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>,</b>1<b>,</b>2<b>)</b><b> </b><b>=</b><b> </b>TurID<b> </b><b>)</b><b> </b><b>and</b><b> </b><b>(</b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>,</b>3<b>,</b>1<b>)</b><b> </b><b>=</b><b> </b>GrupID<b>)</b><b>)</b><b> </b><b>then</b>
<b>          </b>TF<b>=</b>1<b> </b><b>;</b>
<b>          </b><b>else</b>
<b>          </b>TF<b>=</b>0<b> </b><b>;</b>
<b>         </b><b>end</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>0<b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>
<b>      </b><b>end</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b>GrupId<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>       </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' FRK ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b> </b>'- N.RK'<b> </b><b>|</b><b>|</b><b> </b>nUMARASTR<b>;</b>
<b>     </b><b>end</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>100<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* ChustTextile */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>GrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>         </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>5<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>106<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Texco */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabReceteGrupId<b> </b><font color="# 0 0FF"><i>--and</i></font>
<b>             </b><font color="# 0 0FF"><i>-- LabRecete.ReceteTuruId = new.ReceteTuruId</i></font>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>105<b>)</b><b> </b><b>then</b><b>   </b><font color="# 0 0FF"><i>--FISTIK TEKSTİL</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurId<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruID<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b>  </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>2000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>3000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>4000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>5000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>6000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>7000<b>;</b>
<b>      </b><font color="# 0 0FF"><i>/*/  else if  (New.LabRenkGrupID = 8) then</i></font>
<font color="# 0 0FF"><i>        New.Numara = 8000;</i></font>
<font color="# 0 0FF"><i>        else if (New.LabRenkGrupID = 9) then</i></font>
<font color="# 0 0FF"><i>        New.Numara = 9000;</i></font>
<font color="# 0 0FF"><i>        else if (New.LabRenkGrupID = 10)  then</i></font>
<font color="# 0 0FF"><i>        New.Numara = 10000;  */</i></font>
<b>        </b><b>else</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b><b>Null</b><b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkihaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>119<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*MarmaraBoya*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b><font color="# 080 0"><u>LabreceteGrup</u></font><b>.</b>adi<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabreceteGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabreceteGrup</u></font><b>.</b>labrecetegrupid<b> </b><b>=</b><b> </b><b>new</b><b>.</b>labrecetegrupid<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>renkderinligiid<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>'Derinlik gir'<b>;</b>

<b>        </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>  </b><b>where</b>
<b>               </b><font color="# 0 0FF"><i>/* f_Year(LabRecete.TalepTarihi) = f_Year(new.TalepTarihi) and bu satıri mus_erdem kaldırtti */</i></font>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>LabreceteGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabreceteGrupID
<b>          </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>          </b><b>if</b><b>      </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>10000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>20000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>30000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>40000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>50000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>60000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>70000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>80000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>90000<b>;</b>
<b>        </b><b>end</b>
<b>        </b><b>else</b>
<b>          </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>5<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>122<b>  </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*global*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>renkderinligiid<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>'Derinlik gir'<b>;</b>
<b>      </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabReceteGrupId<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>          </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b>=</b>124<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Miray*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>TurID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b>=</b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b><b>:</b><b> </b>TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabGrupId<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>            </b><b>exception</b><b> </b><font color="# 080 0"><u>kayithatasi</u></font><b> </b>'Lab Grup Bos Olamaz'<b>;</b>

<b>         </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>         </b><font color="# 0 0FF"><i>/* where f_year(labrecete.taleptarihi)=f_year(new.Talep.Tarihi) */</i></font>
<b>         </b><b>into</b><b> </b><b>:</b><b> </b>MaxNumara<b>;</b>

<b>         </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>numara<b>=</b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>numara<b>=</b>MaxNumara<b>+</b>1<b>;</b>
<b>         </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b><b>new</b><b>.</b>LabGrupId<b> </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>numara<b>,</b>4<b>)</b><b>;</b>
<b>     </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b>=</b>125<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Mayteks*/</i></font>
<b>  </b><b>begin</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b>2<b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>GrupId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>Where</b><b> </b>LabRenkGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>
<b>    </b><b>select</b><b> </b>TurID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b>=</b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b><b>:</b><b> </b>TurID<b>;</b>

<b>    </b><b>if</b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b> </b>:GrupID<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>:DerinlikId<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>:TurID<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>exception</b><b> </b><font color="# 080 0"><u>kayithatasi</u></font><b> </b>'Bilgiler eksik'<b>;</b>
<b>      </b><b>else</b>
<b>        </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>          </b><b>where</b><b> </b><font color="# 080 0"><u>f_year</u></font><b>(</b><font color="# 080 0"><u>labrecete</u></font><b>.</b>taleptarihi<b>)</b><b>=</b><font color="# 080 0"><u>f_year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b>
<b>          </b><b>into</b><b> </b><b>:</b><b> </b>MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>numara<b>=</b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>numara<b>=</b>MaxNumara<b>+</b>1<b>;</b>
<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>numara<b>,</b>5<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>129<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Merboy*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabReceteGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>3<b>)</b><b>;</b>

<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>131<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Unver*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b><b>Select</b><b> </b><b>case</b><b> </b>LabreceteGrupID<b>  </b><b>when</b><b> </b>1<b> </b><b>then</b><b> </b>'IP'<b> </b><b>when</b><b> </b>2<b> </b><b>then</b><b> </b>'HT'<b> </b><b>when</b><b> </b>3<b> </b><b>then</b><b> </b>'PB'<b> </b><b>end</b><b>  </b><b>from</b><b> </b><font color="# 080 0"><u>LabreceteGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabreceteGrup</u></font><b>.</b>LabreceteGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabreceteGrupID<b> </b><b>into</b><b> </b>:LabreceteGrupStr<b>;</b>

<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabReceteGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>LabreceteGrupStr<b> </b><b>|</b><b>|</b><b> </b>LabreceteAyraci<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b>=</b>98<b>)</b><b> </b><b>then</b><b>   </b><font color="# 0 0FF"><i>--MAHMUTOĞLU</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurId<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>          </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>            </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruID<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>and</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b>
<b>            </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>          </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>          </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>          </b><b>begin</b>
<b>            </b><b>if</b><b>  </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>2000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>3000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>4000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>5000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>6000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>7000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>8000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>9000<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>10<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>10000<b>;</b>
<b>            </b><b>else</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b><b>Null</b><b>;</b>
<b>          </b><b>end</b>
<b>         </b><b>else</b>
<b>         </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkihaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>133<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Bteks Çorlu  */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b>YilStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>TimeStampToYil</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b>;</b>

<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabGrupId<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b>  </b><b>exception</b><b> </b><font color="# 080 0"><u>kayithatasi</u></font><b> </b>'Lab Grup Bos Olamaz'<b>;</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>renkderinligiid<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>'Derinlik gir Bos Olamaz'<b>;</b>


<b>      </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruID<b> </b><b>into</b><b> </b>:TurId<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b><b>(</b>TurId<b> </b><b>=</b><b> </b>'C'<b>)</b><b> </b><b>or</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'V'<b>)</b><b> </b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>          </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>          </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>in</b><b> </b><b>(</b>3<b>,</b>7<b>)</b><b>  </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID
<b>          </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>          </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>20000<b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>(</b>TurId<b> </b><b>=</b><b> </b>'PC'<b>)</b><b> </b><b>or</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'PV'<b>)</b><b> </b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>in</b><b> </b><b>(</b>2<b>,</b>9<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>20000<b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b>
<b>      </b><b>begin</b>
<b>          </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>          </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruID
<b>          </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>          </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>20000<b>;</b>
<b>      </b><b>end</b>

<b>      </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b>  </b>TurId<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b>   </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>5<b>)</b><b> </b><b>|</b><b>|</b><b> </b><b>new</b><b>.</b>LabGrupId<b> </b><b>;</b>
<b>     </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>  </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>54<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*inteks*/</i></font>
<b>  </b><b>begin</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b><b>select</b><b> </b>GrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>     </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><b>coalesce</b><b>(</b><b>new</b><b>.</b>LabGrupId<b>,</b>'00'<b>)</b><b> </b><b>|</b><b>|</b><b> </b>'-'<b> </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b>  </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>      </b>NumaraDigit<b> </b><b>=</b><b>  </b><b>Char_Length</b><b>(</b>IkiHaneYil<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>GrupID<b>)</b><b> </b><b>+</b>
<b>                     </b><b>Char_Length</b><b>(</b><b>coalesce</b><b>(</b><b>new</b><b>.</b>LabGrupId<b>,</b>'00'<b>)</b><b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>'-'<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>TurID<b>)</b><b> </b><b>;</b>

<b>      </b>MaxLen<b> </b><b>=</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>-</b><b> </b>NumaraDigit<b>;</b>
<b>      </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b>NumaraDigit<b>,</b><b> </b>MaxLen<b>)</b><b>;</b>

<b>      </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b> </b>' Recete Kodu ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b>;</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b>  </b><b>coalesce</b><b>(</b><b>new</b><b>.</b>LabGrupId<b>,</b>'00'<b>)</b><b> </b><b>|</b><b>|</b><b> </b>'-'<b> </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b>  </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>        </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' Recete Kodu ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b>;</b>

<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b>=</b>134<b>)</b><b> </b><b>then</b><b>   </b><font color="# 0 0FF"><i>--BAHMAL TEKSTİL</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:ReceteTurId<b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruID<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b>ReceteTurId<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>10<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>21000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>11<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>22000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>12<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>23000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>13<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>24000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>14<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>25000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>15<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>26000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>16<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>27000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>17<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>28000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>18<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>29000<b>;</b>
<b>          </b><b>else</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b><b>Null</b><b>;</b>
<b>        </b><b>end</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>ReceteTurId<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>10<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>61000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>11<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>62000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>12<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>63000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>13<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>64000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>14<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>65000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>15<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>66000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>16<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>67000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>17<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>68000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>18<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>69000<b>;</b>
<b>          </b><b>else</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b><b>Null</b><b>;</b>
<b>        </b><b>end</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>ReceteTurId<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>          </b><b>if</b><b>  </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>10<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>31000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>11<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>32000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>12<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>33000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>13<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>34000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>14<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>35000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>15<b>)</b><b>  </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>36000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>16<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>37000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>17<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>38000<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>18<b>)</b><b> </b><b>then</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>39000<b>;</b>
<b>          </b><b>else</b>
<b>            </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b><b>Null</b><b>;</b>
<b>        </b><b>end</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>5<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>127<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Kalemdar Tekstil*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b><b>Select</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>Grupid<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupId<b>=</b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>into</b><b>  </b>:GrupId<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>

<b>        </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>  </b><b>where</b>
<b>              </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>LabreceteGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabreceteGrupID<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>Labrecete</u></font><b>.</b>ReceteTuruid<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruid
<b>          </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>         </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>001<b>;</b>

<b>        </b><b>end</b>
<b>        </b><b>else</b>
<b>          </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'K'<b>|</b><b>|</b>IkiHaneYil<b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>GrupId<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>5<b>)</b><b>;</b>
<b>    </b><b>end</b>

<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>  </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>137<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Afsin*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>renkderinligiid<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>'Derinlik gir'<b>;</b>
<b>      </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabReceteGrupId<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabGrupId<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>           </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabGrupId<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabGrupId<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>          </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>  </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>139<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*EmnDenim*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>     </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruID<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID
<b>     </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b>  </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1000<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b>  </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>2000<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>3000<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>4000<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>6000<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>7000<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>8000<b>;</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>9000<b>;</b>
<b>    </b><b>end</b>
<b>       </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>    </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabreceteKoduTipi<b>=</b>111<b>)</b><b> </b><b>then</b><b>   </b><font color="# 0 0FF"><i>/*Daka*/</i></font>
<b>  </b><b>begin</b>
<b>      </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>       </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>       </b><b>if</b><b>  </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b>  </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>000001<b> </b><b>;</b>
<b>       </b><b>else</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>     </b><b>new</b><b>.</b>labrecetekodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>6<b>)</b><b>;</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>  </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>141<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Varka*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>RenkDerinligiID<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>'Derinlik girilmemiş !!'<b>;</b>
<b>      </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabReceteGrupId<b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>



<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b>  </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>

<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>144<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* BROŞ  */</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>&lt;</b><b> </b>0<b> </b><b>and</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>&gt;</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>KayitHatasi</u></font><b> </b>'Renk Grup Hatalı...'<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>      </b><b>begin</b>
<b>        </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>0<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>100<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>10000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>20000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>30000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>40000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>50000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>60000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>70000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>80000<b>;</b>
<b>        </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>90000<b>;</b>
<b>      </b><b>end</b>

<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>'B'<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b>  </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b>  </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>5<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>      </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b>-</b>4<b>,</b><b> </b>5<b>)</b><b>;</b>

<b>      </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b><b> </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>0<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b>   </b>100<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>10000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>1<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>10000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>20000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>2<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>20000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>30000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>3<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>30000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>40000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>4<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>40000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>50000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>5<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>50000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>60000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>6<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>60000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>70000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>7<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>70000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>80000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>8<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>80000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>90000<b>)</b><b>)</b><b> </b><b>or</b>
<b>             </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>9<b> </b><b>and</b><b> </b><b>(</b><b>New</b><b>.</b>Numara<b> </b><b>&lt;</b><b> </b>90000<b> </b><b>or</b><b> </b><b>New</b><b>.</b>Numara<b> </b><b>&gt;</b><b>=</b><b> </b>99999<b>)</b><b>)</b><b> </b><b>)</b><b> </b><b>then</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' Numara ='<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntegerToStr</u></font><b>(</b><b>New</b><b>.</b>Numara<b>)</b><b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>'B'<b> </b><b>|</b><b>|</b><b>  </b>IkiHaneYil<b>  </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b>TurId<b>  </b><b>|</b><b>|</b><b> </b>LabReceteAyraci<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>5<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>       </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' FRK ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b> </b>'- N.RK='<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>  </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>142<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Abm Cotton*/</i></font>
<b>  </b><b>begin</b><b>         </b><font color="# 0 0FF"><i>/* Serkan Bey ve Berk Bey'in isteğiyle değiştirildi.</i></font>
<font color="# 0 0FF"><i>    select LabRenkGrupID from LabRenkGrup where LabRenkGrup.LabRenkGrupID = new.LabRenkGrupID into :GrupID;</i></font>
<font color="# 0 0FF"><i>    select TurId from ReceteTuru where ReceteTuru.ReceteTuruId = new.ReceteTuruId into :TurID;</i></font>
<font color="# 0 0FF"><i>    Select DerinlikId from RenkDerinligi where RenkDerinligi.RenkDerinligiID = new.RenkDerinligiId into :DerinlikId;</i></font>
<font color="# 0 0FF"><i>    if (new.LabReceteKodu is null) then</i></font>
<font color="# 0 0FF"><i>    begin</i></font>
<font color="# 0 0FF"><i>      if (new.RenkDerinligiID is null) then exception KayitHatasi 'Renk Derinlik girilmemiş Lüften Kontrol Ediniz!!';</i></font>
<font color="# 0 0FF"><i>      select max(Numara) from LabRecete</i></font>
<font color="# 0 0FF"><i>        where LabRecete.FirmaID = new.FirmaId and</i></font>
<font color="# 0 0FF"><i>              LabRecete.LabRenkGrupID = new.LabRenkGrupId  and</i></font>
<font color="# 0 0FF"><i>              LabRecete.LabReceteGrupId = new.LabReceteGrupId and</i></font>
<font color="# 0 0FF"><i>              LabRecete.ReceteTuruId = new.ReceteTuruId</i></font>
<font color="# 0 0FF"><i>        into :MaxNumara;</i></font>

<font color="# 0 0FF"><i>      if (MaxNumara is null) then new.Numara = 1; else new.Numara = MaxNumara + 1;</i></font>

<font color="# 0 0FF"><i>      New.LabReceteKodu = EgemenCopyStr(New.FirmaId, LabReceteFirmaBaslangic, LabReceteFirmaDigit) || LabReceteAyraci ||</i></font>
<font color="# 0 0FF"><i>                          DerinlikId  ||   TurId || EgemenIntegerToStr(New.LabRenkGrupId) || EgemenIntToLzStr(new.Numara, 3);</i></font>
<font color="# 0 0FF"><i>    end</i></font>
<font color="# 0 0FF"><i>              */</i></font>

<b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b> </b><b>into</b><b> </b>:MaxNumara<b>;</b>
<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>&lt;</b><b> </b>7000<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>7000<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>146<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/* Özsar */</i></font>
<b>  </b><b>begin</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruID<b> </b><b>into</b><b> </b>:TurId<b>;</b>
<b>    </b><b>Select</b><b> </b>GrupId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupId<b> </b><b>into</b><b> </b>:GrupId<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>if</b><b> </b><b>(</b><b>(</b>TurId<b> </b><b>=</b><b> </b>'C'<b>)</b><b> </b><b>or</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'V'<b>)</b><b> </b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>
<b>          </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>in</b><b> </b><b>(</b>3<b>,</b>5<b>)</b><b>  </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID
<b>          </b><b>and</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>          </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>          </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>          </b><b>begin</b>
<b>            </b><b>if</b><b>      </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>10<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>350<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>20<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>150<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>30<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>250<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>40<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>100<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>50<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>200<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>60<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>350<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>70<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>100<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>80<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>150<b>;</b>
<b>            </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>90<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>250<b>;</b>
<b>          </b><b>end</b>
<b>          </b><b>else</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>end</b>
<b>      </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>(</b>TurId<b> </b><b>=</b><b> </b>'P'<b>)</b><b> </b><b>or</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'PW'<b>)</b><b> </b><b>or</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'PV'<b>)</b><b> </b><b>or</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'N'<b>)</b><b>  </b><b>)</b><b> </b><b>then</b>
<b>      </b><b>begin</b>

<b>        </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>  </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>in</b><b> </b><b>(</b>1<b>,</b>2<b>,</b>4<b>,</b>6<b>)</b><b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID
<b>        </b><b>and</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>begin</b>
<b>          </b><b>if</b><b>      </b><b>(</b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>10<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>250<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>20<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>150<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>30<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>300<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>40<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>100<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>50<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>200<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>60<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>450<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>70<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>150<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>80<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>200<b>;</b>
<b>          </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b>90<b>)</b><b> </b><b>then</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>300<b>;</b>
<b>        </b><b>end</b>
<b>        </b><b>else</b><b> </b>MaxNumara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>      </b><b>end</b>
<b>      </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'N'<b> </b><b>)</b><b> </b><b>then</b>
<b>        </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b>  </b>TurId<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>|</b><b>|</b><b>  </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b>   </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b>MaxNumara<b>,</b>4<b>)</b><b>  </b><b>;</b>
<b>      </b><b>else</b>
<b>        </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b>  </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b>  </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b>   </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b>MaxNumara<b>,</b>4<b>)</b><b>  </b><b>;</b>
<b>     </b><b>end</b>
<b>     </b><b>else</b>
<b>     </b><b>begin</b>
<b>       </b><b>if</b><b> </b><b>(</b><b>substring</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>from</b><b> </b>1<b> </b><b>for</b><b> </b>2<b>)</b><b> </b><b>=</b><b> </b>'YM'<b>)</b><b> </b><b>then</b><b> </b>FHaslik<b> </b><b>=</b><b> </b>'YM'<b>;</b>
<b>       </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>substring</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>from</b><b> </b>1<b> </b><b>for</b><b> </b>1<b>)</b><b> </b><b>=</b><b> </b>'H'<b>)</b><b> </b><b>then</b><b> </b>FHaslik<b> </b><b>=</b><b> </b>'H'<b>;</b>
<b>     </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>substring</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>from</b><b> </b>1<b> </b><b>for</b><b> </b>1<b>)</b><b> </b><b>=</b><b> </b>'N'<b>)</b><b> </b><b>then</b><b> </b>FHaslik<b> </b><b>=</b><b> </b>'N'<b>;</b>
<b>       </b><b>else</b><b> </b>FHaslik<b> </b><b>=</b>''<b>;</b>

<b>       </b><b>if</b><b> </b><b>(</b>TurId<b> </b><b>=</b><b> </b>'N'<b> </b><b>)</b><b> </b><b>then</b>
<b>         </b>FLabReceteKodu<b> </b><b>=</b><b>  </b>FHaslik<b>|</b><b>|</b>TurId<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>|</b><b>|</b><b>  </b>IkiHaneYil<b>   </b><b>;</b>
<b>       </b><b>else</b>
<b>         </b>FLabReceteKodu<b> </b><b>=</b><b>  </b>FHaslik<b>|</b><b>|</b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b>  </b>IkiHaneYil<b>  </b><b>;</b>

<b>       </b>NumaraDigit<b> </b><b>=</b><b>  </b><b>Char_Length</b><b>(</b>FLabReceteKodu<b>)</b><b> </b><b>;</b>

<b>       </b>MaxLen<b> </b><b>=</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>-</b><b> </b>NumaraDigit<b> </b><b>+</b>1<b>;</b>

<b>       </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b>NumaraDigit<b>+</b>1<b>,</b><b> </b>MaxLen<b>-</b>1<b>)</b><b>;</b>

<b>       </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>       </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>       </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>       </b>FLabReceteKodu<b> </b><b>=</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b>   </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b>4<b>)</b><b>  </b><b>;</b>

<b>       </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>         </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' FRK ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b> </b><b>|</b><b>|</b><b> </b>'- N.RK'<b> </b><b>|</b><b>|</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>  </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>145<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Ecesoy*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>current_date</b><b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><font color="# 0 0FF"><i>--and</i></font>
<b>              </b><font color="# 0 0FF"><i>--LabRecete.LabReceteGrupId = new.LabReceteGrupId and</i></font>
<b>              </b><font color="# 0 0FF"><i>--LabRecete.ReceteTuruId = new.ReceteTuruId</i></font>
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabGrupId<b> </b><b>is</b><b> </b><b>not</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>           </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabGrupId<b> </b><b>|</b><b>|</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>          </b><b>if</b><b> </b><b>(</b><b>new</b><b>.</b>LabGrupId<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>          </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b><b>  </b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>54<b> </b><b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*inteks*/</i></font>
<b>  </b><b>begin</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>Select</b><b> </b>DerinlikId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>RenkDerinligi</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId<b> </b><b>into</b><b> </b>:DerinlikId<b>;</b>
<b>    </b><b>select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>new</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b><b>select</b><b> </b>GrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>

<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>       </b><b>where</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>ReceteTuruID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruID<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabRenkGrupID<b> </b><b>and</b><b> </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>RenkDerinligiID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>RenkDerinligiId
<b>       </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>        </b><b>New</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b>
<b>      </b><b>else</b>
<b>        </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>

<b>      </b><b>new</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>
<b>    </b><b>end</b>
<b>    </b><b>else</b>
<b>    </b><b>begin</b>
<b>      </b>NumaraDigit<b> </b><b>=</b><b>  </b><b>Char_Length</b><b>(</b>IkiHaneYil<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>DerinlikId<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>TurID<b>)</b><b> </b><b>+</b><b> </b><b>Char_Length</b><b>(</b>GrupID<b>)</b><b>;</b>

<b>      </b>MaxLen<b> </b><b>=</b><b> </b><b>Char_Length</b><b>(</b><b>new</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>-</b><b> </b>NumaraDigit<b>;</b>
<b>      </b>NumaraStr<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenCopyStr</u></font><b>(</b><b>New</b><b>.</b>LabReceteKodu<b>,</b><b> </b>NumaraDigit<b>,</b><b> </b>MaxLen<b>)</b><b>;</b>


<b>      </b>TF<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToIntOlurmu</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>TF<b> </b><b>=</b><b> </b>1<b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenStrToInt</u></font><b>(</b>NumaraStr<b>)</b><b>;</b>
<b>      </b><b>else</b><b> </b><b>exception</b><b> </b><font color="# 080 0"><u>ReceteNumaraOlusturulamadi</u></font><b>;</b>

<b>      </b>FLabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>DerinlikId<b> </b><b>|</b><b>|</b><b> </b>TurID<b> </b><b>|</b><b>|</b><b> </b>GrupID<b> </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>      </b><b>if</b><b> </b><b>(</b>FLabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b> </b><b>or</b><b> </b>FLabReceteKodu<b> </b><b>&lt;</b><b>&gt;</b><b> </b><b>New</b><b>.</b>LabReceteKodu<b>)</b><b> </b><b>then</b>
<b>        </b><b>exception</b><b> </b><font color="# 080 0"><u>ManuelGirilenLabRecKoduHatali</u></font><b> </b>' Recete Kodu ='<b> </b><b>|</b><b>|</b><b> </b>FLabReceteKodu<b>;</b>

<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>  </b><b>else</b><b> </b><b>if</b><b> </b><b>(</b>LabReceteKoduTipi<b> </b><b>=</b><b> </b>150<b>)</b><b> </b><b>then</b><b> </b><font color="# 0 0FF"><i>/*Özaytaç*/</i></font>
<b>  </b><b>begin</b>
<b>    </b><b>Select</b><b> </b>LabRenkGrupID<b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>LabRenkGrup</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupID<b> </b><b>into</b><b> </b>:GrupID<b>;</b>
<b>    </b><b>Select</b><b> </b>TurId<b> </b><b>from</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b> </b><b>where</b><b> </b><font color="# 080 0"><u>ReceteTuru</u></font><b>.</b>ReceteTuruId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>ReceteTuruId<b> </b><b>into</b><b> </b>:TurID<b>;</b>
<b>    </b>IkiHaneYil<b> </b><b>=</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>(</b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>new</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>-</b><b> </b>2000<b>)</b><b>,</b><b> </b>2<b>)</b><b>;</b>
<b>    </b><b>if</b><b> </b><b>(</b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b>
<b>    </b><b>begin</b>
<b>      </b><b>Select</b><b> </b><b>max</b><b>(</b>Numara<b>)</b><b> </b><b>from</b><b> </b><font color="# 080 0"><u>LabRecete</u></font>
<b>        </b><b>where</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>TalepTarihi<b>)</b><b> </b><b>=</b><b> </b><font color="# 080 0"><u>f_Year</u></font><b>(</b><b>New</b><b>.</b>TalepTarihi<b>)</b><b> </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabRenkGrupID<b> </b><b>=</b><b> </b><b>new</b><b>.</b>LabRenkGrupId<b>  </b><b>and</b>
<b>              </b><font color="# 080 0"><u>LabRecete</u></font><b>.</b>LabReceteGrupId<b> </b><b>=</b><b> </b><b>New</b><b>.</b>LabReceteGrupId
<b>        </b><b>into</b><b> </b>:MaxNumara<b>;</b>

<b>        </b><b>if</b><b> </b><b>(</b>MaxNumara<b> </b><b>is</b><b> </b><b>null</b><b>)</b><b> </b><b>then</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>1<b>;</b><b> </b><b>else</b><b> </b><b>new</b><b>.</b>Numara<b> </b><b>=</b><b> </b>MaxNumara<b> </b><b>+</b><b> </b>1<b>;</b>
<b>        </b><b>New</b><b>.</b>LabReceteKodu<b> </b><b>=</b><b> </b>IkiHaneYil<b> </b><b>|</b><b>|</b><b> </b>TurId<b> </b><b>|</b><b>|</b><b> </b>GrupID<b>  </b><b>|</b><b>|</b><b> </b><font color="# 080 0"><u>EgemenIntToLzStr</u></font><b>(</b><b>new</b><b>.</b>Numara<b>,</b><b> </b>4<b>)</b><b>;</b>

<b>    </b><b>end</b>
<b>  </b><b>end</b>
<b>end</b>

</pre></code>
</span></P>
<P CLASS="Base">&nbsp;</P>
<DIV CLASS="footer"><BR><HR></DIV>
  <TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH=100%>
    <TR VALIGN="middle">
      <TD>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
      <TD ALIGN="left" WIDTH="54px" NOWRAP>
        <A HREF="BEFOREINSERTLABRECETE2.html"><IMG ALT="Previous topic" SRC="../Images/GoPrev.gif" BORDER="0"></A>
        <A HREF="../Index.html"><IMG ALT="Chapter index" SRC="../Images/GoIndex.gif" BORDER="0"></A>
        <A HREF="BEFOREINSERTLABRECETE4.html"><IMG ALT="Next topic" SRC="../Images/GoNext.gif" BORDER="0"></A>
      </TD>
    </TR>
  </TABLE>
<P CLASS="Base">&nbsp;</P>
</BODY></HTML>